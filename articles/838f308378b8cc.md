---
title: "Goã®ozzo-validationã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¦ã¿ãŸ"
emoji: "ğŸ˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "Go"
  - "API"
  - "Web"
published: false
---

# ã¯ã˜ã‚ã«

Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã§ API ã‚’é–‹ç™ºã™ã‚‹éš›ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ãŒå¤šã„ã‹ã¨æ€ã„ã¾ã™ã€‚
ä»Šå›ã¯ã€Go ã®`ozzo-validation`ã‚’ä½¿ç”¨ã—ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’ä½œã£ã¦ã¿ãŸã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚„æ„Ÿæƒ³ã‚’ã¾ã¨ã‚ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ãªãŠã€ã‚µãƒ³ãƒ—ãƒ«ä½œæˆã«ä½¿ç”¨ã™ã‚‹ Go ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚

- Go Version: 1.21.0
- Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯: [Gin](https://github.com/gin-gonic/gin)

https://github.com/go-ozzo/ozzo-validation

:::message
gin ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦[go-playground/validator](https://github.com/go-playground/validator)ã‚’[æ¡ç”¨ã—ã¦ã„ã¾ã™](https://gin-gonic.com/ja/docs/examples/binding-and-validation/)ã€‚
`ozzo-validation`ã‚’ä½¿ç”¨ã—ãªãã¦ã‚‚ã€`go-playground`ã®è¨˜æ³•ã§æ›¸ã‘ã°ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè£…å¯èƒ½ã§ã™ã€‚
ãŸã ã€ä»Šå›ã¯`ozzo-validation`ã‚’ä½¿ã£ã¦ã¿ãŸã‹ã£ãŸã®ã§`gin`ã¨åˆã‚ã›ã¦ä½¿ã£ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ï¼
:::

ãªãŠã€ä»Šå›ã®è¨˜äº‹ã«ã¤ã„ã¦ã€ã‚³ãƒ¼ãƒ‰ã‹ã‚‰è¦‹ãŸã„æ–¹ã¯ã“ã¡ã‚‰ã‹ã‚‰ã©ã†ã
https://github.com/yuuLab/go-validation

# ç›®æ¨™

POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã® JSON ãƒœãƒ‡ã‚£ã«å¯¾ã—ã¦å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’è¡Œã„ã€ä»¥ä¸‹ã®ä»•æ§˜é€šã‚Šã«ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã§ãã‚‹ã“ã¨ã‚’ã‚´ãƒ¼ãƒ«ã«ã—ã¾ã™ã€‚

- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®å ´åˆã€`400 Bad Request`ãŒè¿”å´ã•ã‚Œã‚‹ã“ã¨
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®å ´åˆã€`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å`ã¨ãã®`ç†ç”±`ãŒè¿”å´ã•ã‚Œã‚‹ã“ã¨
- è¤‡æ•°ã®ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹å ´åˆã€ã‚¨ãƒ©ãƒ¼ã¨ãªã£ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã™ã¹ã¦è¿”å´ã•ã‚Œã‚‹ã“ã¨

ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒœãƒ‡ã‚£ã¯[RFC 7807](https://datatracker.ietf.org/doc/html/rfc7807)ã‚’å‚è€ƒã«ã€ä»¥ä¸‹ã®ä»•æ§˜ã§è¿”å´ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚
`type`ã¯ã‚¨ãƒ©ãƒ¼ã”ã¨ã«ä¸€æ„ã¨ãªã‚‹ã‚¨ãƒ©ãƒ¼å®šæ•°ã€`title`ã¯ã‚¨ãƒ©ãƒ¼æ¦‚è¦ã€`invalid-params`ã¯ã‚¨ãƒ©ãƒ¼ã¨ãªã£ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŠã‚ˆã³ç†ç”±ã®é…åˆ—ã§ã™ã€‚
:::details ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ä¾‹

```json
{
  "type": "VALIDATION_ERROR",
  "title": "Your request parameters didn't validate.",
  "invalid-params": [
    {
      "name": "age",
      "reason": "must be a positive integer"
    },
    {
      "name": "color",
      "reason": "must be 'green', 'red' or 'blue'"
    }
  ]
}
```

:::

`RFC 7807`ã¾ã‚ã‚Šã«ã¤ã„ã¦ã¯ã€rry ã•ã‚“ã®[ã¼ãã®ã‹ã‚“ãŒãˆãŸã•ã„ãã‚‡ã†ã® API ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ](https://zenn.dev/ryamakuchi/articles/d7c932afc57e30)ãŒå‚è€ƒã«ãªã‚Šã¾ã—ãŸï¼

# ä½¿ã„æ–¹ãƒ»è§£èª¬

## ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å†…å®¹ã®å®šç¾©

`ozzo-validation`ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã¯ã€struct ã«`Validate()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å†…å®¹ã‚’ã‚³ãƒ¼ãƒ‰ã§æ›¸ãå½¢ã«ãªã‚Šã¾ã™ã€‚
ã‚¿ã‚°ã§ã¯ãªãã€ã‚³ãƒ¼ãƒ‰ã§è¨˜è¼‰ã§ãã‚‹ã®ã§ã€ã‚¿ã‚°ãŒç…©é›‘ãªã‚‰ãšã«è¦‹ã‚„ã™ã„ã¾ã¾ã«ä¿ã¦ã¾ã™ã€‚
ã¾ãŸã€ã‚¿ã‚°ã«ã¯`json`ã‚¿ã‚°ä»¥å¤–ã®ä¿®æ­£ãŒå…¥ã‚‰ãªã„ã®ã§ã€OpenAPI ã‹ã‚‰ã®è‡ªå‹•ç”Ÿæˆã¨ã‚‚ç›¸æ€§ãŒè‰¯ã•ãã†ã§ã™ã€‚
:::details book_request.go (struct ã‚³ãƒ¼ãƒ‰ä¾‹)

```go
import validation "github.com/go-ozzo/ozzo-validation"

type Book struct {
	Title  string  `json:"title"`
	Author string  `json:"author"`
	Price  float64 `json:"price"`
	Genre  string  `json:"genre"`
}

func (b Book) Validate() error {
	//NOTE: æ—¥æœ¬èªã®ã‚¨ãƒ©ãƒ¼æ–‡ãŒä¸è¦ã§ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è‹±èªã®ã‚¨ãƒ©ãƒ¼æ–‡ã§å¿…è¦ååˆ†ã§ã‚ã‚‹å ´åˆã€`.Error("xxx")`ã¯ä¸è¦ã§OK
	return validation.ValidateStruct(&b,
		validation.Field(
			&b.Title,
			validation.Required.Error("ã‚¿ã‚¤ãƒˆãƒ«ã¯å¿…é ˆé …ç›®ã§ã™ã€‚"),
			validation.RuneLength(1, 50).Error("ã‚¿ã‚¤ãƒˆãƒ«ã¯ 1æ–‡å­— ä»¥ä¸Š 50æ–‡å­— ä»¥å†…ã§ã™ã€‚"),
		),
		validation.Field(
			&b.Author,
			validation.Required.Error("è‘—è€…åã¯å¿…é ˆé …ç›®ã§ã™ã€‚"),
			validation.RuneLength(1, 50).Error("è‘—è€…åã¯ 1æ–‡å­— ä»¥ä¸Š 50æ–‡å­— ä»¥å†…ã§ã™ã€‚"),
		),
		validation.Field(
			&b.Price,
			validation.Required.Error("ä¾¡æ ¼ã¯å¿…é ˆé …ç›®ã§ã™ã€‚"),
			validation.Max(1000000.0).Error("ä¾¡æ ¼ã¯ 1,000,000å†† ä»¥ä¸‹ã§æŒ‡å®šã—ã¦ãã ã•ã„ã€‚"),
			validation.Min(1.0).Error("ä¾¡æ ¼ã¯ 1å†† ä»¥ä¸Šã§æŒ‡å®šã—ã¦ãã ã•ã„ã€‚"),
		),
		validation.Field(
			&b.Genre,
			validation.In("NOVELS", "COMIC", "FICTION", "NON_FICTION").Error("å€¤ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚"),
		),
	)
}

```

:::
ä¸Šè¨˜ã®ã‚ˆã†ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã”ã¨ã«ãƒã‚§ãƒƒã‚¯å†…å®¹ã‚’æŒ‡å®šã—ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚æ—¥æœ¬èªã«å¤‰ãˆãŸã„å ´åˆã¯ Error()ã®å¼•æ•°ã«æ¸¡ã™ã“ã¨ã§å¤‰æ›´ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

## ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯

struct ã‚’æ¸¡ã—ã¦ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã—ã¦ãã‚Œã‚‹å®Ÿè£…ä¾‹ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚
`Validate()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚‚ã¤ struct ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹`validation.Validatable`ã‚’æº€ãŸã™ã®ã§ã€ãã‚Œã‚’ç¢ºèªå¾Œã€`Validate()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

:::details ozzo_validation.go (ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯å®Ÿè£…)

```go
// Validator performs validation on parameters.
type Validator struct{}

// Validate performs validation on any given interface.
// If the provided interface is valid or doesn't implement the validation.Validatable interface, it returns nil.
func (v Validator) Validate(obj any) error {
	if obj == nil {
		return nil
	}

	val, ok := obj.(validation.Validatable)
	if !ok {
		return nil
	}
	if err := val.Validate(); err != nil {
		if verr, ok := err.(validation.Errors); ok {
			var params []response.InvalidParams
			for key, val := range verr {
				params = append(params, response.InvalidParams{Name: key, Reason: val.Error()})
			}
			return v.newValidationError(params, err)
		}
		return v.newServerError(err)
	}
	return nil
}

// newValidationError creates an error that wraps a Internal Error.
func (v Validator) newServerError(err error) error {
	return ValidationError{
		response: response.ValidationError{Type: "SERVER_ERROR", Title: "unexpected errors"},
		status:   http.StatusInternalServerError,
		err:      err,
	}
}

// newValidationError creates an error that wraps a Validation Error.
func (v Validator) newValidationError(params []response.InvalidParams, err error) error {
	return ValidationError{
		response: response.ValidationError{Type: "VALIDATION_ERROR", Title: "validation errors", Pramas: params},
		status:   http.StatusBadRequest,
		err:      err,
	}
}

// validation/error.go
// ValidationError represents validation error.
type ValidationError struct {
	response response.ValidationError
	status   int
	err      error
}

// Error returns the error string of Errors.
func (v ValidationError) Error() string {
	return v.err.Error()
}

// Response returns the Response.
func (v ValidationError) Response() response.ValidationError {
	return v.response
}

// Status returns the Status Code.
func (v ValidationError) Status() int {
	return v.status
}
```

:::

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®å ´åˆã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å¤‰æ›ã™ã‚‹å‡¦ç†ã¯å…±é€šåŒ–ã—ã¦ãŠããŸã‹ã£ãŸã®ã§ã€ãã®å‡¦ç†ã‚‚`Validate()`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§è¡Œã£ã¦ã„ã¾ã™ã€‚
`validation.Errors`ã®å®Ÿæ…‹ã¯ `map` ã§ã‚ã‚Šã€`Key`ãŒã‚¨ãƒ©ãƒ¼ã¨ãªã£ãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã€`Value`ãŒã‚¨ãƒ©ãƒ¼ç†ç”±ã¨ã—ã¦ã€ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼æƒ…å ±ãŒä¿æŒã•ã‚Œã¦ã„ã¾ã™ã€‚
ãã‚Œã‚’ãƒ«ãƒ¼ãƒ—ã§å›ã—ã¦ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ§‹ç¯‰ã—ã¦ã„ã¾ã™ã€‚
ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ§‹é€ ä½“ã¯æ¬¡ã®é€šã‚Šã€‚
:::details error_response.go

```go
type InvalidParams struct {
	Name   string `json:"name"`
	Reason string `json:"reason"`
}

type ValidationError struct {
	Type   string          `json:"type"`
	Title  string          `json:"title"`
	Pramas []InvalidParams `json:"invalid-params"`
}

```

:::

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã®åŸºæœ¬çš„ãªå®Ÿè£…ã¯ä»¥ä¸Šã§çµ‚äº†ã§ã™ãŒã€ã“ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯å‡¦ç†ã‚’`gin`ã®ä»•çµ„ã¿ã«ã®ã›ã¦ã€ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°æ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã•ã‚‰ã«å°‘ã—æ”¹ä¿®ã—ã¾ã™ã€‚

## gin ã¸çµ„ã¿è¾¼ã¿

ä¸Šè¿°ã—ãŸé€šã‚Šã€`gin`ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`go-playground`ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå‹•ã„ã¦ã¾ã™ã€‚
ãã“ã§ã€`gin`ã®`binding.Validator`ã‚’ç‹¬è‡ªå®Ÿè£…ã—ãŸæ§‹é€ ä½“ã§ä¸Šæ›¸ãã™ã‚Œã°ã€ãƒã‚¤ãƒ³ãƒ‰æ™‚ã«å‹•ä½œã™ã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã§ã™ã€‚
`binding.Validator`ã«ç™»éŒ²ã™ã‚‹ãŸã‚ã«ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹`StructValidator`ã‚’æº€ãŸã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã€ã“ã‚Œã‚’æº€ãŸã™ã‚ˆã†ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®æ§‹é€ ä½“ã‚’ä½œæˆã—ã¾ã™ã€‚

â€»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯[`github.com/gin-gonic/gin/blob/master/binding/binding.go #StructValidator`](https://github.com/gin-gonic/gin/blob/master/binding/binding.go)å‚ç…§

å…ˆã»ã©ä½œæˆã—ãŸã€`ozzo_validation.go`ã®`Validator`ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹å½¢ã§ã€`StructValidator`ã‚’æº€ãŸã™ã‚ˆã†ã«å®Ÿè£…ã‚’è¿½åŠ ã—ã¾ã™ã€‚
:::details ozzo_validation.go (StructValidator ã®å®Ÿè£…)

```go
// +++è¿½åŠ éƒ¨åˆ†+++
// ozzoValidator implements the binding.StructValidator.
type ozzoValidator struct {
	validator *Validator
}

func NewOzzoValidator() binding.StructValidator {
	return &ozzoValidator{validator: &Validator{}}
}

func (v *ozzoValidator) ValidateStruct(obj any) error {
	return v.validator.Validate(obj)
}

func (v *ozzoValidator) Engine() any {
	return v.validator
}
// +++è¿½åŠ éƒ¨åˆ†+++
```

:::

ã‚ã¨ã¯`main.go`ã§`ozzoValidator`ã‚’`binding.Validator`ã«æŒ‡å®šã™ã‚Œã°ã€ç‹¬è‡ªå®Ÿè£…ã—ãŸ`ozzo-validation`ã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå‹•ãã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
:::details main.go

```go
func main() {
	r := gin.Default()
	// set validator
	binding.Validator = validation.NewOzzoValidator()
	r.POST("/books", handler.NewBookHandler().Create)
	r.Run()
}
```

:::
ã“ã®ã‚ˆã†ã«`gin` ã® `Validator` ã«ã‚»ãƒƒãƒˆã—ã¦ãŠãã“ã¨ã§ã€ãƒã‚¤ãƒ³ãƒ‰æ™‚ï¼ˆä¾‹ãˆã°ã€`ShouldBindJSON()`ï¼‰ã«å®Ÿè£…ã—ãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’å‘¼ã³å‡ºã—ã¦ãã‚Œã¾ã™ã€‚

ã‚ã¨ã¯ã€å„ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§ã„ã¤ã‚‚é€šã‚Šãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å¤‰æ›å‡¦ç†ã‚’è¡Œã„ã€`ValidationError`ã ã£ãŸå ´åˆã¯ã€ç”Ÿæˆã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã‚ˆã†ã«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚
ä»¥ä¸‹ã¯å®Ÿè£…ä¾‹ã§ã™ã€‚
:::details book_handler.go

```go
type bookHandler struct {
}

// NewBookHandler creates a new BookHandler.
func NewBookHandler() *bookHandler {
	return &bookHandler{}
}

// Create creates a new book from request information.
func (h *bookHandler) Create(c *gin.Context) {
	var req request.Book
	if err := c.ShouldBindJSON(&req); err != nil {
		slog.Info(err.Error())
		if verr, ok := err.(validation.ValidationError); ok {
			c.JSON(verr.Status(), verr.Response())
			return
		}
		// json decord errors, etc.
		c.Status(http.StatusBadRequest)
		return
	}

	//TODO: create a new book...

	c.Status(http.StatusCreated)
}

```

:::

:::message
gin ã®ä»•çµ„ã¿ã«ä¹—ã›ã¦ã¿ã¦æ€ã£ãŸã®ã§ã™ãŒã€gin ã® Validator ã«ãƒã‚¤ãƒ³ãƒ‰ã—ãªã„æ–¹ãŒå¯èª­æ€§ãŒé«˜ã„æ°—ã‚‚ã™ã‚‹ã®ã§ã€ã©ã®ã‚ˆã†ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’çµ„ã¿è¾¼ã‚€ã‹ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ã§ç›¸è«‡ã™ã‚‹ã®ãŒè‰¯ã„ã‹ã¨æ€ã„ã¾ã™ã€‚
:::

# ozzo-validation ã®è‰¯ã•ãã†ãªç‚¹

- ã‚¿ã‚°ãŒç…©é›‘ã«ãªã‚‰ãªã„
- ã‚¿ã‚°ã‚’ä¿®æ­£ã—ãªã„ã®ã§è‡ªå‹•ç”Ÿæˆç³»ã¨ç›¸æ€§è‰¯ã•ãã†
- Go ã®ã‚³ãƒ¼ãƒ‰ã§è¡¨ç¾ã§ãã‚‹ã®ã§ã€æ›¸ãé–“é•ã„ãªã©ã®ã‚¨ãƒ©ãƒ¼ã«ã™ãã«æ°—ãŒã¤ã‘ã‚‹
- README ãŒå€‹äººçš„ã«è¦‹ã‚„ã™ãã¦ã€ã™ãã«ä½¿ã„å§‹ã‚ã‚‰ã‚Œã‚‹
- æ¡ä»¶ä»˜ãå¿…é ˆã®è¡¨ç¾ãŒç›´æ„Ÿçš„ã‹ã¤æŸ”è»Ÿ
  å…¬å¼ã® README ã«ã‚‚è¨˜è¼‰ã‚ã‚‹é€šã‚Šã€ä»¥ä¸‹ã®ã‚ˆã†ã«ç›´æ„Ÿçš„ã‹ã¤`ozzo-validation`ã‚’åˆã‚ã¦ã¿ã‚‹äººã§ã‚‚ã™ãã«æ„å‘³ãŒã‚ã‹ã‚‹ã€‚
  ```go
  result := validation.ValidateStruct(&a,
      validation.Field(&a.Unit, validation.When(a.Quantity != "", validation.Required).Else(validation.Nil)),
      validation.Field(&a.Phone, validation.When(a.Email == "", validation.Required.Error('Either phone or Email is required.')),
      validation.Field(&a.Email, validation.When(a.Phone == "", validation.Required.Error('Either phone or Email is required.')),
  )
  ```
- ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã™ãã«ä½œã‚Œã‚‹
  ã“ã¡ã‚‰ã‚‚å…¬å¼ã«ã‚ã‚‹ãŒã€æ¤œè¨¼ã—ãŸã„å†…å®¹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦`error`ã‚’è¿”ã™é–¢æ•°ã‚’ä½œã‚Šã€`validation.By()`ã«æ¸¡ã™ã ã‘ã§æ©Ÿèƒ½ã—ã¦ãã‚Œã¾ã™ã€‚

  ```go
  func checkAbc(value interface{}) error {
    s, _ := value.(string)
    if s != "abc" {
      return errors.New("must be abc")
    }
    return nil
  }

  err := validation.Validate("xyz", validation.By(checkAbc))
  fmt.Println(err)
  // Output: must be abc
  ```

# ã•ã„ã”ã«

`ozzo-validation`ã¯ç›´æ„Ÿçš„ã‹ã¤æŸ”è»Ÿæ€§ã‚‚ã‚ã‚Šã€éå¸¸ã«ä½¿ã„ã‚„ã™ãã†ã«æ„Ÿã˜ã¾ã—ãŸã€‚
ç§è‡ªèº«ãšã£ã¨ Java ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã€ã¾ã ã¾ã  Go æ­´ãŒæµ…ã„ã®ã§ã€ã”æŒ‡æ‘˜ç­‰ã‚ã‚Œã°ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚

èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼

# å‚è€ƒ

https://github.com/go-ozzo/ozzo-validation
https://zenn.dev/mattn/articles/893f28eff96129
https://gin-gonic.com/ja/
https://zenn.dev/ryamakuchi/articles/d7c932afc57e30
https://datatracker.ietf.org/doc/html/rfc7807
