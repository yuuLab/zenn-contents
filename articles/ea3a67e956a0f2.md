---
title: "ActiveMQ Artemisã‚’ä½¿ç”¨ã—ãŸéåŒæœŸå‡¦ç†ã‚’æ§‹ç¯‰ã—ã¦ã¿ãŸ"
emoji: "ğŸ‰"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - Java
  - JMS
  - ActiveMQ
  - Spring
published: true
---

# æœ¬è¨˜äº‹ã®ç›®çš„

æœ¬è¨˜äº‹ã®ã‚´ãƒ¼ãƒ«ã¯ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†ã‚’æ§‹ç¯‰ã—ã€ActiveMQ Artemis ã‚’åˆ©ç”¨ã—ãŸã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿéš›ã«å‹•ä½œç¢ºèªã—ã¦ã¿ã‚‹ã“ã¨ã§ã™ã€‚
Spring Boot Ã— JMS ã‚’ç”¨ã„ã¦ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã¨ã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒãƒ¼ã‚’ãã‚Œãã‚Œæ§‹ç¯‰ã—ã€ã‚­ãƒ¥ãƒ¼ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç™»éŒ²ãƒ»ã‚­ãƒ¥ãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

ãªãŠã€ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ Github ã«ãŠã„ã¦ã‚ã‚Šã¾ã™ã®ã§ã“ã¡ã‚‰ã¨åˆã‚ã›ã¦ç¢ºèªã„ãŸã ã‘ãŸã‚‰ã¨æ€ã„ã¾ã™ã€‚

https://github.com/yuuLab/active-mq

# ActiveMQ Artemis ã¨ã¯ï¼Ÿ

ActiveMQ ã¯ Java ãƒ™ãƒ¼ã‚¹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ã§ã™ã€‚
ActiveMQ ã«ã¯ 2023 å¹´ 2 æœˆç¾åœ¨ã€â€Classicâ€ã¨â€Artemisâ€ã¨å‘¼ã°ã‚Œã‚‹äºŒç¨®é¡ãŒæä¾›ã•ã‚Œã¦ãŠã‚Šã€Artemis ã¯æ¬¡ä¸–ä»£å‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ã¨ã„ã†ä½ç½®ä»˜ã‘ã§ã™ã€‚
ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ä½¿ã‚ã‚Œã‚‹ã‚ˆã†ãªã‚·ã‚¹ãƒ†ãƒ é–“ã§éåŒæœŸã«æƒ…å ±ã‚’ã‚„ã‚Šã¨ã‚Šã™ã‚‹éš›ã«åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦ã¯ã€æœ€è¿‘ã ã¨ Amazon SQS ã‚„ Amazon MQ ãªã©ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ˆãåˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

# ActiveMQ Artemis ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã¾ãšã¯ä»¥ä¸‹æ‰‹é †ã«å¾“ã„ã€ActiveMQ ã‚’é–‹ç™ºãƒã‚·ãƒ³ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«&ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã¾ã§è¡Œã„ã¾ã™ã€‚
ãªãŠã€[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ > Latest User Documentation > Using the Server](https://activemq.apache.org/components/artemis/documentation/)ã«è©³ç´°ãŒè¼‰ã£ã¦ã„ã‚‹ã®ã§ãã¡ã‚‰ã‹ã‚‰ã§ã‚‚ OK ã§ã™ã€‚

1. [Apache ActiveMQ](https://activemq.apache.org/components/artemis/download/)ã®å…¬å¼ã‚µã‚¤ãƒˆã‹ã‚‰ Artemis ç‰ˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚
1. è§£å‡å¾Œã€`${ARTEMIS_HOME}/bin` é…ä¸‹ã«ç§»å‹•ã—ã¦ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ä»»æ„ã®åå‰ã§ãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ã‚’ä½œæˆã™ã‚‹ã€‚ãã®å¾Œãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›ãŒä¿ƒã•ã‚Œã‚‹ã®ã§é©å½“ã«å…¥åŠ›ã—ã¾ã™ã€‚ï¼ˆä¾‹ã§ã¯ `mybroker`ï¼‰
   ```
   ${ARTEMIS_HOME}/artemis create mybroker
   ```
1. `mybroker` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã®ã§ã€run ã‚³ãƒãƒ³ãƒ‰ã§ ActiveMQ ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚

   ```
   ${ARTEMIS_HOME}/mybroker/bin/artemis run
   ```

1. å‡ºåŠ›ã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚ï¼ˆä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã‚Œã°å•é¡Œãªã—ã€‚ï¼‰

   ```
   2023-02-11 18:15:48,252 INFO [org.apache.activemq.artemis] AMQ241004 :Artemis Console available at http://localhost:8161/console
   ```

1. ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ãŒå‡ºã¦ãã‚‹ã®ã§ã€ãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ä½œæˆæ™‚ã«å…¥åŠ›ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æŒ‡å®šã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚
   ![](/images/activemq/activemq-login.png)

ãƒ­ã‚°ã‚¤ãƒ³ã§ããŸã‚‰ ActiveMQ ã®æº–å‚™ã¯å®Œäº†ã§ã™ï¼

# ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼å´ã®æ§‹ç¯‰ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼‰

:::message
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡å´ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®`build.gradle`ã®å†…å®¹ã¯ä»¥ä¸‹å‚ç…§ã€‚
https://github.com/yuuLab/active-mq/blob/main/active-mq-producer/build.gradle
:::

Java Message Service (JMS)ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚­ãƒ¥ãƒ¼ã«é€ä¿¡ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚
JMS ã¯ JNDI ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€ã¾ãšã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ•ã‚¡ã‚¤ãƒ«`jndi.properties`ã‚’ç”¨æ„ã—ã¾ã—ã‚‡ã†ã€‚
ä»Šå›ã¯`TestQueue`ã¨ã„ã†åå‰ã®ã‚­ãƒ¥ãƒ¼ã«å¯¾ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã¨ã—ã¾ã™ã€‚

`<project-dir>/src/main/resouces/jndi.properties`

```properties
# JNDIåˆæœŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ã®è¨­å®š
java.naming.factory.initial = org.apache.activemq.artemis.jndi.ActiveMQInitialContextFactory

# JMSæ¥ç¶šãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ï¼ˆæ¥ç¶šä½œæˆã®ãŸã‚ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼šURLï¼‰
# connectionFactory.<factory-name> = <connection-uri>
connectionFactory.ConnectionFactory=tcp://localhost:61616

# ã‚­ãƒ¥ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’JNDIã«ç™»éŒ²
# queue.[JNDIå] = [ã‚­ãƒ¥ãƒ¼ã®åå‰]
# queue.<queue-lookup-name> = <queue-name>
queue.Queue = TestQueue
# ã‚­ãƒ¥ãƒ¼ã®æ•°ã ã‘è¿½è¨˜ã™ã‚‹ã€‚
# â€» ã‚­ãƒ¥ãƒ¼ã§ã¯ãªããƒˆãƒ”ãƒƒã‚¯ã®å ´åˆã¯ã€topic.<topic-lookup-name> = <topic-name>
```

ã‚ã¨ã¯ Java å´ã®å®Ÿè£…ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®šã‹ã‚‰ã‚­ãƒ¥ãƒ¼ã«æ¥ç¶šã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ã¾ã™ã€‚
ä»Šå›ã¯å‹•ä½œç¢ºèªãªã®ã§ã€é€ä¿¡ãƒ‡ãƒ¼ã‚¿ã¯ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ã§ã‚‚ã‚‰ã„ã€ãã‚Œã‚’ãã®ã¾ã¾ MQ ã«é€ä¿¡ã™ã‚‹ä»•æ§˜ã¨ã—ã¾ã™ã€‚

`/src/main/java/com/yuulab/activemq/producer/Pruducer.java`

```java
public class Producer {
  /**
  *  ã‚­ãƒ¥ãƒ¼ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ã€‚
  *
  * @param data é€ä¿¡ãƒ‡ãƒ¼ã‚¿
  * @return JMS Message ID
  */
  public String send(Serializable data) {
    InitialContext initialContext;
    QueueConnectionFactory factory;
    try {
      // JNDIã®è¨­å®šã‹ã‚‰Factoryç”Ÿæˆ
      initialContext = new InitialContext();
      factory = (QueueConnectionFactory) initialContext.lookup("ConnectionFactory");
    } catch (NamingException e) {
      throw new RuntimeException("åå‰è§£æ±ºã«å¤±æ•—ã—ã¾ã—ãŸã€‚", e);
    }

    // connection, session ç”Ÿæˆ
    try (QueueConnection connection = factory.createQueueConnection();
          QueueSession session = connection.createQueueSession(false, Session.AUTO_ACKNOWLEDGE);) {
      connection.start();
      // create message
      ObjectMessage message = session.createObjectMessage(data);
      // send
      Queue originalQueue = (Queue) initialContext.lookup("Queue");
      session.createSender(originalQueue).send(message);
      System.out.println("ActiveMQã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚" + message.getJMSMessageID());
      connection.close();
      return message.getJMSMessageID();
    } catch (JMSException | NamingException e) {
      throw new RuntimeException("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", e);
    }
  }
}

```

ã•ã¦ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ä½™åœ°ã¯ã‚ã‚Šãã†ã§ã™ãŒåŸºæœ¬çš„ãªä½œã‚Šã¯ä»¥ä¸Šã§å®Œäº†ã§ã™ã€‚å®Ÿéš›ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
API çµŒç”±ã§æ°åæƒ…å ±ã‚’é€ã‚Šã€ãã‚Œã‚’ãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ã«ç™»éŒ²ã™ã‚‹æµã‚Œã¨ä»®å®šã—ã¾ã™ã€‚
ã§ã™ã®ã§çªè²«ã§ã™ãŒ Controller ã¨é€ä¿¡ç”¨ãƒ‡ãƒ¼ã‚¿ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¦ãŠãã¾ã™ã€‚MQ ã«ã¯ `First Name`, `Last Name`, `Random ID` ã‚’é€£æºã™ã‚‹ä»•æ§˜ã¨ã—ã¾ã™ã€‚

`/src/main/java/com/yuulab/activemq/presentation/TestController.java`

```java
@RestController
public class TestController {

  @GetMapping(value = "/test")
  public Status get(@RequestParam(name = "fistName", defaultValue = "taro") String firstName,
      @RequestParam(name = "lastName", defaultValue = "tanaka") String lastName) {
    Producer pub = new Producer();
    TestQueueData data = new TestQueueData(this.generateId(), firstName, lastName);
    pub.send(data);

    return new Status("OK");
  }

  @Getter
  class Status {
    private final String status;

    public Status(String status) {
    this.status = status;
  }
}

  private String generateId() {
    SecureRandom sr;
    try {
      sr = SecureRandom.getInstance("SHA1PRNG");
      return String.valueOf(sr.nextInt());
    } catch (NoSuchAlgorithmException e) {
      throw new RuntimeException("IDã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚", e);
    }
  }
}
```

`/src/main/java/com/yuulab/activemq/data/TestQueueData.java`

```java
public record TestQueueData(
  String id,
  String firstName,
  String lastName) implements Serializable {
}
```

ä»¥ä¸Šã§æº–å‚™ OK ã§ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚
ãªãŠã€ã‚­ãƒ¥ãƒ¼ã¯ã‚ã‚‰ã‹ã˜ã‚ä½œæˆã—ã¦ãŠãå¿…è¦ã¯ãªãã€æŒ‡å®šã—ãŸåå‰ã®ã‚­ãƒ¥ãƒ¼ãŒå­˜åœ¨ã—ãªã‘ã‚Œã°å‹æ‰‹ã«ä½œæˆã—ã¦ãã‚Œã‚‹ã¿ãŸã„ã§ã™ã€‚ï¼ˆï¼Ÿï¼‰
ã§ã™ã®ã§ä»Šå›ã ã¨`TestQueue`ã¨ã„ã†åå‰ã®ã‚­ãƒ¥ãƒ¼ãŒä½œæˆã•ã‚Œã€ãã“ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒç™»éŒ²ã•ã‚Œã¦ã„ãã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ã§ã¯ã€å‹•ã‹ã—ã¦ç¢ºã‹ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€‚API ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•å¾Œã€ä»¥ä¸‹ curl ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```
curl -i -X GET \
 'http://localhost:8080/test?firstName=sato&lastName=jiro'
```

ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã‚’è¦‹ã‚‹ã¨ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãŒæˆåŠŸã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

```
.....
[2m2023-02-11T19:16:31.562+09:00[0;39m [32m INFO[0;39m [35m16968[0;39m [2m---[0;39m [2m[nio-8080-exec-1][0;39m [36mo.a.c.c.C.[Tomcat].[localhost].[/]      [0;39m [2m:[0;39m Initializing Spring DispatcherServlet 'dispatcherServlet'
[2m2023-02-11T19:16:31.563+09:00[0;39m [32m INFO[0;39m [35m16968[0;39m [2m---[0;39m [2m[nio-8080-exec-1][0;39m [36mo.s.web.servlet.DispatcherServlet       [0;39m [2m:[0;39m Initializing Servlet 'dispatcherServlet'
[2m2023-02-11T19:16:31.565+09:00[0;39m [32m INFO[0;39m [35m16968[0;39m [2m---[0;39m [2m[nio-8080-exec-1][0;39m [36mo.s.web.servlet.DispatcherServlet       [0;39m [2m:[0;39m Completed initialization in 1 ms
ActiveMQã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚ID:284e8734-a9f5-11ed-8b67-7278e6dd7973
```

ãã‚Œã§ã¯ ActiveMQ ã®ç®¡ç†ç”»é¢ã‚’ç¢ºèªã—ã¦ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã¿ã¦ã¿ã¾ã™ã€‚
ç®¡ç†ç”»é¢ã‹ã‚‰ Queue ã®æƒ…å ±ã‚’è¦‹ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ã®é€šã‚Š`TestQueue`ã¨ã„ã†åå‰ãŒã¤ã„ãŸã‚­ãƒ¥ãƒ¼ãŒä½œæˆã•ã‚Œã€`Message Count`ãŒ 1 ã«ãªã£ã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
â€»`DLQ`,`ExpiryQueue`ã¯ ActiveMQ èµ·å‹•æ™‚ã«æœ€åˆã‹ã‚‰ã„ã‚‹ä»Šå›ã¨ã¯é–¢ä¿‚ãªã„ã‚­ãƒ¥ãƒ¼ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã€‚

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã«ç„¡äº‹æˆåŠŸã§ã™ï¼
![](/images/activemq/activemq-first-message.png)

`Message Count`ã®æ•°å­—éƒ¨åˆ†ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã•ã‚‰ã«è©³ç´°ã‚’ç¢ºèªã—ã¾ã™ã€‚
![](/images/activemq/activemq-first-message-detail.png)
ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ã€Object ã‚¿ã‚¤ãƒ—ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã€User ID ã‚‚ãƒ­ã‚°ã«å‡ºåŠ›ã•ã‚Œã¦ã„ãŸ ID ã¨ä¸€è‡´ã—ã¦ã„ã¾ã™ã€‚
ãªãŠã€ç¾çŠ¶ã‚­ãƒ¥ãƒ¼ã‹ã‚‰å–ã‚Šå‡ºã™ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãªã„çŠ¶æ…‹ãªã®ã§ã€ç™»éŒ²ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ãã®ã¾ã¾ä¿æŒã•ã‚Œã¦ã„ã¾ã™ã€‚

æ¬¡ã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—ä¿¡å´ã‚’æ§‹ç¯‰ã—ã¦ã„ãã¾ã™ï¼

# ã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒãƒ¼å´ã®æ§‹ç¯‰ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡ï¼‰

:::message
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡å´ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®`build.gradle`ã®å†…å®¹ã¯ä»¥ä¸‹å‚ç…§ã€‚
https://github.com/yuuLab/active-mq/blob/main/active-mq-consumer/build.gradle
:::

å—ã‘å–ã‚Šå´ã¯ Spring æ§˜ã®ãŠã‹ã‘ã§ã‘ã£ã“ã†ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚Spring ã®åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”¨æ„ã—ã€`application.properties`ã«è¨­å®šã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

`<project-dir>/src/main/resouces/application.properties`

```properties
spring.artemis.mode=native
spring.artemis.broker-url=tcp://localhost:61616
# portè¢«ã‚‰ãªã„ã‚ˆã†ã«è¨­å®šã—ã¦ãŠã
server.port=8081
```

ã‚ã¨ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒªã‚¹ãƒŠãƒ¼ã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã—ã¦ã‚ã’ã‚Œã°ã€è‡ªå‹•çš„ã«ã‚­ãƒ¥ãƒ¼ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¿½åŠ ã•ã‚ŒãŸã‚‰ãã‚Œã‚’æ‹¾ã£ã¦ãã‚Œã¾ã™ã€‚
`/src/main/java/com/yuulab/activemq/consumer/TestQueueListener`

```java
@Component
public class TestQueueListener {

  /**
   * TestQueueã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚‹ã€‚
   * @param data ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
   * @throws InterruptedException
   */
  @JmsListener(destination = "TestQueue")
  public void receive(TestQueueData data) throws InterruptedException {
    System.out.println("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã—ã¾ã—ãŸã€‚" + data);
    // dummy sleep
    Thread.sleep(10000L);
  }
}
```

ã•ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¦ã€æœ€åˆã«ç™»éŒ²ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–ã‚Šå‡ºã—ã¦ãƒ­ã‚°ã«å‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
ä»¥ä¸‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•å¾Œã®ãƒ­ã‚°å†…å®¹ã§ã™ã€‚ã™ãã«å…ˆã»ã©ã‚­ãƒ¥ãƒ¼ã«ç™»éŒ²ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ‹¾ãˆã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

```
...
[2m2023-02-11T21:13:46.654+09:00[0;39m [32m INFO[0;39m [35m24331[0;39m [2m---[0;39m [2m[  restartedMain][0;39m [36mo.s.b.w.embedded.tomcat.TomcatWebServer [0;39m [2m:[0;39m Tomcat started on port(s): 8081 (http) with context path ''
[2m2023-02-11T21:13:47.300+09:00[0;39m [32m INFO[0;39m [35m24331[0;39m [2m---[0;39m [2m[  restartedMain][0;39m [36mc.y.a.ActiveMqConsumerApplication       [0;39m [2m:[0;39m Started ActiveMqConsumerApplication in 2.917 seconds (process running for 3.798)
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã—ã¾ã—ãŸã€‚TestQueueData[id=-2117026429, firstName=taro, lastName=jiro]
```

ç°¡å˜ã§ã™ã­ã€ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯å‰å¤§ã§ã™ã€‚

# æœ€å¾Œã«

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°å‡¦ç†ã®åŸºæœ¬çš„ãªæ©Ÿèƒ½ã®æ§‹ç¯‰ã¯ä»¥ä¸Šã¨ãªã‚Šã¾ã™ã€‚
å®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯è¦ä»¶ã«åˆã‚ã›ã€ã‚­ãƒ¥ãƒ¼ã®æ•°ã‚„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–ã‚Šå‡ºã—å¾Œã®å‡¦ç†ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€å¤±æ•—ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ‰±ã„ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ°¸ç¶šåŒ–ãªã©è€ƒãˆã‚‹å¿…è¦ãŒã•ã‚‰ã«ãŸãã•ã‚“ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

ãŸã ã€ã¾ãšã¯å‹•ãã‚‚ã®ã‚’ä½œã£ã¦ã¿ã‚‹ã¨ã„ã†ã®ã‚‚é‡è¦ãªã®ã§ã€ã™ãã«å‹•ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°å‡¦ç†ã‚’ä½œã‚ŠãŸã„å ´åˆã«ã“ã¡ã‚‰ã®è¨˜äº‹/ã‚³ãƒ¼ãƒ‰ãŒãŠå½¹ã«ç«‹ã¦ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚
ä»Šåº¦æ©Ÿä¼šãŒã‚ã‚Œã° Amazon SQS ã‚’åˆ©ç”¨ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã®ã‚µãƒ³ãƒ—ãƒ«ä½œã£ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ã§ã¯ã¾ãŸãŠä¼šã„ã—ã¾ã—ã‚‡ã†ï¼

# å‚è€ƒè¨˜äº‹

https://activemq.apache.org/components/artemis/documentation/

https://terasolunaorg.github.io/guideline/5.3.0.RELEASE/ja/ArchitectureInDetail/MessagingDetail/JMS.html

https://access.redhat.com/documentation/ja-jp/red_hat_amq/7.7/html/using_the_amq_core_protocol_jms_client/index

https://spring.pleiades.io/guides/gs/messaging-jms/

https://spring.pleiades.io/spring-boot/docs/current/reference/html/messaging.html

https://www.techscore.com/tech/Java/JavaEE/JMS/
